<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–∞–≤–∏–ª–≥—ã–Ω –î—ç–ª–≥“Ø“Ø—Ä</title>
  <!-- Prevent caching -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <!-- App version - change this to force update -->
  <meta name="version" content="2.0.3">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    // Auto-refresh check every 5 minutes
    const APP_VERSION = '2.0.3';
    setInterval(() => {
      fetch(window.location.href + '?v=' + Date.now())
        .then(r => r.text())
        .then(html => {
          const match = html.match(/name="version" content="([^"]+)"/);
          if (match && match[1] !== APP_VERSION) {
            if (confirm('–®–∏–Ω—ç —Ö—É–≤–∏–ª–±–∞—Ä –±—ç–ª—ç–Ω –±–æ–ª–ª–æ–æ! –®–∏–Ω—ç—á–ª—ç—Ö “Ø“Ø?')) {
              window.location.reload(true);
            }
          }
        })
        .catch(() => {});
    }, 5 * 60 * 1000); // Check every 5 minutes
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Icons as simple components
    const Icon = ({ name, className }) => {
      useEffect(() => {
        lucide.createIcons();
      }, []);
      return <i data-lucide={name} className={className}></i>;
    };

    // Mongolian Currency Formatter
    const formatMNT = (amount) => {
      return new Intl.NumberFormat('mn-MN').format(amount) + '‚ÇÆ';
    };

    // Password Modal Component
    const PasswordModal = ({ isOpen, onClose, onSuccess, title }) => {
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const correctPassword = '1234';

      if (!isOpen) return null;

      const handleSubmit = () => {
        if (password === correctPassword) {
          onSuccess();
          setPassword('');
          setError('');
        } else {
          setError('–ù—É—É—Ü “Ø–≥ –±—É—Ä—É—É –±–∞–π–Ω–∞');
        }
      };

      return (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
          <div className="bg-slate-800 rounded-2xl p-6 w-full max-w-sm border border-amber-500/20 shadow-2xl mx-4">
            <div className="flex items-center gap-3 mb-6">
              <div className="p-3 bg-amber-500/20 rounded-xl">
                <span className="text-amber-400 text-xl">üîí</span>
              </div>
              <h3 className="text-xl font-bold text-white">{title}</h3>
            </div>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="–ù—É—É—Ü “Ø–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É"
              className="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:border-amber-500 focus:outline-none mb-4"
              onKeyPress={(e) => e.key === 'Enter' && handleSubmit()}
            />
            {error && <p className="text-red-400 text-sm mb-4">{error}</p>}
            <div className="flex gap-3">
              <button onClick={onClose} className="flex-1 p-3 bg-slate-700 text-white rounded-xl hover:bg-slate-600 transition-colors">
                –ë–æ–ª–∏—Ö
              </button>
              <button onClick={handleSubmit} className="flex-1 p-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold hover:from-amber-600 hover:to-orange-600 transition-all">
                –ù—ç–≤—Ç—Ä—ç—Ö
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Main App
    // Google Sheets API URL
    const SHEETS_API = 'https://script.google.com/macros/s/AKfycbypuz5flEviRVfcvmDFtfvlKkfFq8YdrHGSgHocpzmH_6iG7ynIAqFblnmX83EiZOWf6w/exec';

    // Check if driver mode
    const isDriverMode = window.location.search.includes('driver');

    function App() {
      const [activeTab, setActiveTab] = useState(isDriverMode ? 'delivery' : 'dashboard');
      const [showPasswordModal, setShowPasswordModal] = useState(false);
      const [pendingTab, setPendingTab] = useState(null);
      const [unlockedTabs, setUnlockedTabs] = useState({ inventory: false, settings: false });
      const [isLoading, setIsLoading] = useState(true);
      const [isSaving, setIsSaving] = useState(false);
      const [lastSync, setLastSync] = useState(null);

      const [inventory, setInventory] = useState([]);
      const [orders, setOrders] = useState([]);

      // Load data from Google Sheets on startup
      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        setIsLoading(true);
        try {
          const invRes = await fetch(SHEETS_API + '?action=getInventory', { method: 'GET', redirect: 'follow' });
          const invData = await invRes.json();
          if (invData.data) setInventory(invData.data);
          
          const ordRes = await fetch(SHEETS_API + '?action=getOrders', { method: 'GET', redirect: 'follow' });
          const ordData = await ordRes.json();
          if (ordData.data) setOrders(ordData.data);
          
          setLastSync(new Date().toLocaleTimeString('mn-MN'));
        } catch (error) {
          console.error('Load error:', error);
        }
        setIsLoading(false);
      };

      // Save inventory to Google Sheets
      const saveInventory = async (newInventory) => {
        setInventory(newInventory);
        setIsSaving(true);
        try {
          await fetch(SHEETS_API + '?action=saveInventory&data=' + encodeURIComponent(JSON.stringify(newInventory)), {
            method: 'GET',
            redirect: 'follow'
          });
          setLastSync(new Date().toLocaleTimeString('mn-MN'));
        } catch (error) {
          console.error('Save inventory error:', error);
        }
        setIsSaving(false);
      };

      // Save orders to Google Sheets
      const saveOrders = async (newOrders) => {
        setOrders(newOrders);
        setIsSaving(true);
        try {
          await fetch(SHEETS_API + '?action=saveOrders&data=' + encodeURIComponent(JSON.stringify(newOrders)), {
            method: 'GET',
            redirect: 'follow'
          });
          setLastSync(new Date().toLocaleTimeString('mn-MN'));
        } catch (error) {
          console.error('Save orders error:', error);
        }
        setIsSaving(false);
      };

      const [showAddProduct, setShowAddProduct] = useState(false);
      const [showAddOrder, setShowAddOrder] = useState(false);
      const [showOrderDetail, setShowOrderDetail] = useState(null);
      const [showReturnModal, setShowReturnModal] = useState(null);
      const [showEditProduct, setShowEditProduct] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [categoryFilter, setCategoryFilter] = useState('all');
      const [deliveryStatusFilter, setDeliveryStatusFilter] = useState('all');
      const [orderDateFilter, setOrderDateFilter] = useState('all');
      const [orderPhoneSearch, setOrderPhoneSearch] = useState('');
      const [statisticsPeriod, setStatisticsPeriod] = useState('daily');

      const categories = ['all', '–ó–æ—á–Ω—ã ”©—Ä”©”©', '–£–Ω—Ç–ª–∞–≥—ã–Ω ”©—Ä”©”©', '–ì–∞–ª —Ç–æ–≥–æ–æ', '–û—Ñ—Ñ–∏—Å', '–ß–∏–º—ç–≥–ª—ç–ª', '–ë—É—Å–∞–¥'];
      const paymentTypes = ['–¢”©–ª–±”©—Ä 100% —Ç”©–ª—Å”©–Ω', '–£—Ä—å–¥—á–∏–ª–≥–∞–∞ ”©–≥—Å”©–Ω', '–ë—ç–ª—ç–Ω –º”©–Ω–≥”©', '–•“Ø—Ä–≥—ç—Å–Ω–∏–π –¥–∞—Ä–∞–∞ —Ç”©–ª–Ω”©', 'Pocket', 'Storepay'];
      const orderStatuses = { pending: '–•“Ø–ª—ç—ç–≥–¥—ç–∂ –±—É–π', pickup: '–î—ç–ª–≥“Ø“Ø—Ä—ç—ç—Å –∞–≤—Å–∞–Ω', delivered: '–•“Ø—Ä–≥—ç—Å—ç–Ω', returned: '–ë—É—Ü–∞–∞–≥–¥—Å–∞–Ω', cancelled: '–¶—É—Ü–ª–∞–≥–¥—Å–∞–Ω' };

      const handleTabChange = (tab) => {
        if ((tab === 'inventory' || tab === 'settings') && !unlockedTabs[tab]) {
          setPendingTab(tab);
          setShowPasswordModal(true);
        } else {
          setActiveTab(tab);
        }
      };

      const handlePasswordSuccess = () => {
        setUnlockedTabs(prev => ({ ...prev, [pendingTab]: true }));
        setActiveTab(pendingTab);
        setShowPasswordModal(false);
        setPendingTab(null);
      };

      const updateOrderStatus = (orderId, newStatus) => {
        let newInventory = [...inventory];
        const newOrders = orders.map(order => {
          if (order.id === orderId) {
            // Reduce inventory when status changes to 'delivered' or 'pickup'
            if ((newStatus === 'delivered' || newStatus === 'pickup') && order.status !== 'delivered' && order.status !== 'pickup') {
              order.items.forEach(item => {
                newInventory = newInventory.map(product => {
                  if (product.id === item.productId) {
                    if (item.variant && product.variants.length > 0) {
                      return {
                        ...product,
                        stock: product.stock - item.quantity,
                        variants: product.variants.map(v => 
                          v.size === item.variant ? { ...v, stock: v.stock - item.quantity } : v
                        )
                      };
                    }
                    return { ...product, stock: product.stock - item.quantity };
                  }
                  return product;
                });
              });
            }
            return { ...order, status: newStatus };
          }
          return order;
        });
        
        saveInventory(newInventory);
        saveOrders(newOrders);
      };

      const processReturn = (orderId, returnedItems, returnNote) => {
        setOrders(prev => prev.map(order => {
          if (order.id === orderId) {
            returnedItems.forEach(returnItem => {
              if (returnItem.selected) {
                setInventory(invPrev => invPrev.map(product => {
                  if (product.id === returnItem.productId) {
                    if (returnItem.variant && product.variants.length > 0) {
                      return {
                        ...product,
                        stock: product.stock + returnItem.quantity,
                        variants: product.variants.map(v => 
                          v.size === returnItem.variant ? { ...v, stock: v.stock + returnItem.quantity } : v
                        )
                      };
                    }
                    return { ...product, stock: product.stock + returnItem.quantity };
                  }
                  return product;
                }));
              }
            });
            
            const refundAmount = returnedItems
              .filter(item => item.selected)
              .reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            return { 
              ...order, 
              status: 'returned',
              returnNote: returnNote,
              returnedItems: returnedItems.filter(item => item.selected),
              refundAmount: refundAmount
            };
          }
          return order;
        }));
      };

      const getStatistics = () => {
        const today = new Date();
        let filteredOrders = orders.filter(o => o.status !== 'cancelled');
        
        if (statisticsPeriod === 'daily') {
          filteredOrders = filteredOrders.filter(o => new Date(o.date).toDateString() === today.toDateString());
        } else if (statisticsPeriod === 'weekly') {
          const weekAgo = new Date(today);
          weekAgo.setDate(weekAgo.getDate() - 7);
          filteredOrders = filteredOrders.filter(o => new Date(o.date) >= weekAgo);
        } else if (statisticsPeriod === 'monthly') {
          const monthAgo = new Date(today);
          monthAgo.setMonth(monthAgo.getMonth() - 1);
          filteredOrders = filteredOrders.filter(o => new Date(o.date) >= monthAgo);
        }
        
        const totalSales = filteredOrders.reduce((sum, o) => sum + o.total, 0);
        const totalOrders = filteredOrders.length;
        const deliveredOrders = filteredOrders.filter(o => o.status === 'delivered').length;
        const pendingPayment = filteredOrders.reduce((sum, o) => sum + o.remaining, 0);
        
        const productStats = {};
        filteredOrders.forEach(order => {
          order.items.forEach(item => {
            if (!productStats[item.name]) {
              productStats[item.name] = { quantity: 0, revenue: 0 };
            }
            productStats[item.name].quantity += item.quantity;
            productStats[item.name].revenue += item.price * item.quantity * (item.discount ? 0.9 : 1);
          });
        });
        
        return { totalSales, totalOrders, deliveredOrders, pendingPayment, productStats };
      };

      // Helper to get remaining stock for a product/variant
      const getRemainingStock = (productName, variantName) => {
        const product = inventory.find(p => p.name === productName);
        if (!product) return '?';
        if (variantName && product.variants && product.variants.length > 0) {
          const variant = product.variants.find(v => v.size === variantName);
          return variant ? variant.stock : '?';
        }
        return product.stock;
      };

      // Dashboard
      const Dashboard = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const threeDaysAgo = new Date(today);
        threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
        
        // Only show pending orders in active orders list
        const dashboardOrders = orders.filter(order => order.status === 'pending');
        
        const pendingOrders = orders.filter(o => o.status === 'pending').length;
        const deliveredOrders = orders.filter(o => o.status === 'delivered').length;
        const pickupOrders = orders.filter(o => o.status === 'pickup').length;
        const cancelledOrders = orders.filter(o => o.status === 'cancelled').length;
        
        // Today's sales
        const todayStr = new Date().toISOString().split('T')[0];
        const todaysOrders = orders.filter(o => o.date === todayStr && o.status !== 'cancelled');
        const todaysSales = todaysOrders.reduce((sum, o) => sum + o.total, 0);
        
        // Outstanding payments
        const outstandingOrders = orders.filter(o => o.remaining > 0 && o.status !== 'cancelled');
        const totalOutstanding = outstandingOrders.reduce((sum, o) => sum + o.remaining, 0);
        
        // Low stock products
        const lowStockProducts = inventory.filter(p => p.stock <= 5);
        
        const [showOutstandingOrders, setShowOutstandingOrders] = useState(false);
        const [showPendingOrders, setShowPendingOrders] = useState(false);
        const [showDeliveredOrders, setShowDeliveredOrders] = useState(false);
        const [showCancelledOrders, setShowCancelledOrders] = useState(false);
        const [showTodaysSales, setShowTodaysSales] = useState(false);
        
        // Get orders by status
        const pendingOrdersList = orders.filter(o => o.status === 'pending');
        const deliveredOrdersList = orders.filter(o => o.status === 'delivered');
        const cancelledOrdersList = orders.filter(o => o.status === 'cancelled');
        
        // Today's items sold count
        const todaysItemsCount = todaysOrders.reduce((sum, o) => sum + o.items.reduce((s, i) => s + i.quantity, 0), 0);
        
        return (
          <div className="p-4 pb-24">
            <div className="mb-4">
              <h1 className="text-2xl font-bold text-white mb-1">–¢–∞–≤—Ç–∞–π –º–æ—Ä–∏–ª! üëã</h1>
              <p className="text-slate-400">Aspen Homestore</p>
            </div>
            
            {/* Today's Sales & Outstanding */}
            <div className="grid grid-cols-2 gap-3 mb-4">
              <div 
                onClick={() => setShowTodaysSales(!showTodaysSales)}
                className="bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-2xl p-4 border border-green-500/30 cursor-pointer hover:border-green-500/60 transition-colors"
              >
                <p className="text-green-300 text-xs">”®–Ω”©”©–¥—Ä–∏–π–Ω –±–æ—Ä–ª—É—É–ª–∞–ª—Ç üëÜ</p>
                <p className="text-xl font-bold text-white mt-1">{todaysItemsCount} —à–∏—Ä—Ö—ç–≥</p>
                <p className="text-green-300 text-xs mt-1">{todaysOrders.length} –∑–∞—Ö–∏–∞–ª–≥–∞</p>
              </div>
              <div 
                onClick={() => setShowOutstandingOrders(!showOutstandingOrders)}
                className="bg-gradient-to-br from-orange-500/20 to-red-500/20 rounded-2xl p-4 border border-orange-500/30 cursor-pointer hover:border-orange-500/60 transition-colors"
              >
                <p className="text-orange-300 text-xs">–ù–∏–π—Ç –∞–≤–ª–∞–≥–∞ üëÜ</p>
                <p className="text-xl font-bold text-white mt-1">{formatMNT(totalOutstanding)}</p>
                <p className="text-orange-300 text-xs mt-1">{outstandingOrders.length} –∑–∞—Ö–∏–∞–ª–≥–∞</p>
              </div>
            </div>
            
            {/* Today's Sales List */}
            {showTodaysSales && todaysOrders.length > 0 && (
              <div className="mb-4 bg-green-500/10 rounded-xl p-4 border border-green-500/30">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-green-400 font-semibold">üì¶ ”®–Ω”©”©–¥”©—Ä –∑–∞—Ä–∞–≥–¥—Å–∞–Ω</h3>
                  <button onClick={() => setShowTodaysSales(false)} className="text-slate-400 hover:text-white">‚úï</button>
                </div>
                <div className="space-y-2">
                  {todaysOrders.map(order => (
                    <div 
                      key={order.id} 
                      onClick={() => setShowOrderDetail(order)}
                      className="bg-slate-800/50 rounded-lg p-3 cursor-pointer hover:bg-slate-700/50"
                    >
                      <div className="flex justify-between items-center mb-2">
                        <p className="text-white font-semibold">#{order.id} - {order.customerName || order.phone1}</p>
                        <p className="text-green-400 font-bold">{formatMNT(order.total)}</p>
                      </div>
                      <div className="space-y-1">
                        {order.items.map((item, i) => (
                          <div key={i} className="flex items-center gap-2">
                            
                            <span className="text-slate-300 text-sm">{item.name} x{item.quantity}</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Outstanding Orders List */}
            {showOutstandingOrders && outstandingOrders.length > 0 && (
              <div className="mb-4 bg-orange-500/10 rounded-xl p-4 border border-orange-500/30">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-orange-400 font-semibold">üí∞ –ê–≤–ª–∞–≥–∞—Ç–∞–π –∑–∞—Ö–∏–∞–ª–≥—É—É–¥</h3>
                  <button onClick={() => setShowOutstandingOrders(false)} className="text-slate-400 hover:text-white">‚úï</button>
                </div>
                <div className="space-y-2">
                  {outstandingOrders.map(order => (
                    <div 
                      key={order.id} 
                      onClick={() => setShowOrderDetail(order)}
                      className="flex items-center justify-between bg-slate-800/50 rounded-lg p-3 cursor-pointer hover:bg-slate-700/50"
                    >
                      <div>
                        <p className="text-white font-semibold">#{order.id}</p>
                        <p className="text-slate-400 text-xs">{order.customerName || order.phone1}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-orange-400 font-bold">{formatMNT(order.remaining)}</p>
                        <p className="text-slate-400 text-xs">{order.paymentType}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Order Stats - Clickable */}
            <div className="grid grid-cols-3 gap-3 mb-4">
              <div 
                onClick={() => setShowPendingOrders(!showPendingOrders)}
                className="bg-gradient-to-br from-yellow-500/20 to-amber-500/20 rounded-2xl p-3 border border-yellow-500/30 cursor-pointer hover:border-yellow-500/60 transition-colors"
              >
                <p className="text-yellow-300 text-xs">–•“Ø–ª—ç—ç–≥–¥—ç–∂ üëÜ</p>
                <p className="text-2xl font-bold text-white mt-1">{pendingOrdersList.length}</p>
              </div>
              <div 
                onClick={() => setShowDeliveredOrders(!showDeliveredOrders)}
                className="bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-2xl p-3 border border-green-500/30 cursor-pointer hover:border-green-500/60 transition-colors"
              >
                <p className="text-green-300 text-xs">–•“Ø—Ä–≥—ç—Å—ç–Ω üëÜ</p>
                <p className="text-2xl font-bold text-white mt-1">{deliveredOrdersList.length}</p>
              </div>
              <div 
                onClick={() => setShowCancelledOrders(!showCancelledOrders)}
                className="bg-gradient-to-br from-red-500/20 to-pink-500/20 rounded-2xl p-3 border border-red-500/30 cursor-pointer hover:border-red-500/60 transition-colors"
              >
                <p className="text-red-300 text-xs">–¶—É—Ü–ª–∞–≥–¥—Å–∞–Ω üëÜ</p>
                <p className="text-2xl font-bold text-white mt-1">{cancelledOrdersList.length}</p>
              </div>
            </div>
            
            {/* Pending Orders List */}
            {showPendingOrders && pendingOrdersList.length > 0 && (
              <div className="mb-4 bg-yellow-500/10 rounded-xl p-4 border border-yellow-500/30">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-yellow-400 font-semibold">‚è≥ –•“Ø–ª—ç—ç–≥–¥—ç–∂ –±—É–π</h3>
                  <button onClick={() => setShowPendingOrders(false)} className="text-slate-400 hover:text-white">‚úï</button>
                </div>
                <div className="space-y-2">
                  {pendingOrdersList.map(order => (
                    <div 
                      key={order.id} 
                      onClick={() => setShowOrderDetail(order)}
                      className="flex items-center justify-between bg-slate-800/50 rounded-lg p-3 cursor-pointer hover:bg-slate-700/50"
                    >
                      <div>
                        <p className="text-white font-semibold">#{order.id}</p>
                        <p className="text-slate-400 text-xs">{order.customerName || order.phone1}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-yellow-400 font-bold">{formatMNT(order.total)}</p>
                        <p className="text-slate-400 text-xs">{order.date}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Delivered Orders List - with items */}
            {showDeliveredOrders && deliveredOrdersList.length > 0 && (
              <div className="mb-4 bg-green-500/10 rounded-xl p-4 border border-green-500/30">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-green-400 font-semibold">‚úÖ –•“Ø—Ä–≥—ç—Å—ç–Ω</h3>
                  <button onClick={() => setShowDeliveredOrders(false)} className="text-slate-400 hover:text-white">‚úï</button>
                </div>
                <div className="space-y-2">
                  {deliveredOrdersList.map(order => (
                    <div 
                      key={order.id} 
                      onClick={() => setShowOrderDetail(order)}
                      className="bg-slate-800/50 rounded-lg p-3 cursor-pointer hover:bg-slate-700/50"
                    >
                      <div className="flex justify-between items-center mb-2">
                        <p className="text-white font-semibold">#{order.id} - {order.customerName || order.phone1}</p>
                        <p className="text-green-400 font-bold">{formatMNT(order.total)}</p>
                      </div>
                      <div className="space-y-1">
                        {order.items.map((item, i) => (
                          <div key={i} className="flex items-center gap-2">
                            
                            <span className="text-slate-300 text-sm">{item.name} x{item.quantity}</span>
                          </div>
                        ))}
                      </div>
                      <p className="text-slate-500 text-xs mt-2">{order.date}</p>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Cancelled Orders List */}
            {showCancelledOrders && cancelledOrdersList.length > 0 && (
              <div className="mb-4 bg-red-500/10 rounded-xl p-4 border border-red-500/30">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-red-400 font-semibold">‚ùå –¶—É—Ü–ª–∞–≥–¥—Å–∞–Ω</h3>
                  <button onClick={() => setShowCancelledOrders(false)} className="text-slate-400 hover:text-white">‚úï</button>
                </div>
                <div className="space-y-2">
                  {cancelledOrdersList.map(order => (
                    <div 
                      key={order.id} 
                      onClick={() => setShowOrderDetail(order)}
                      className="flex items-center justify-between bg-slate-800/50 rounded-lg p-3 cursor-pointer hover:bg-slate-700/50"
                    >
                      <div>
                        <p className="text-white font-semibold">#{order.id}</p>
                        <p className="text-slate-400 text-xs">{order.customerName || order.phone1}</p>
                      </div>
                      <div className="text-right">
                        <p className="text-red-400 font-bold">{formatMNT(order.total)}</p>
                        <p className="text-slate-400 text-xs">{order.date}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Low Stock Alert */}
            {lowStockProducts.length > 0 && (
              <div className="mb-4 bg-red-500/10 rounded-xl p-4 border border-red-500/30">
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-red-400">‚ö†Ô∏è</span>
                  <h3 className="text-red-400 font-semibold">–ë–∞–≥–∞ “Ø–ª–¥—ç–≥–¥—ç–ª—Ç—ç–π –±–∞—Ä–∞–∞</h3>
                </div>
                <div className="space-y-2">
                  {lowStockProducts.map(product => (
                    <div key={product.id} className="flex items-center justify-between bg-slate-800/50 rounded-lg p-2">
                      <div className="flex items-center gap-2">
                        <span className="text-white text-sm">{product.name}</span>
                      </div>
                      <span className="text-red-400 font-bold">{product.stock} —à</span>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            <div>
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-semibold text-white">–ò–¥—ç–≤—Ö—Ç—ç–π –∑–∞—Ö–∏–∞–ª–≥—É—É–¥</h3>
                <span className="text-slate-400 text-sm">{dashboardOrders.length} –∑–∞—Ö–∏–∞–ª–≥–∞</span>
              </div>
              <div className="space-y-3">
                {dashboardOrders.map(order => (
                  <div
                    key={order.id}
                    onClick={() => setShowOrderDetail(order)}
                    className="bg-slate-800/50 rounded-xl p-4 border border-slate-700 cursor-pointer hover:border-amber-500/50 transition-colors"
                  >
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <p className="text-white font-semibold">#{order.id}</p>
                        <p className="text-slate-400 text-sm">{order.customerName || '–ù—ç—Ä–≥“Ø–π'}</p>
                      </div>
                      <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                        order.status === 'delivered' ? 'bg-green-500/20 text-green-400' :
                        order.status === 'pickup' ? 'bg-blue-500/20 text-blue-400' :
                        order.status === 'returned' ? 'bg-orange-500/20 text-orange-400' :
                        order.status === 'cancelled' ? 'bg-red-500/20 text-red-400' :
                        'bg-yellow-500/20 text-yellow-400'
                      }`}>
                        {orderStatuses[order.status]}
                      </span>
                    </div>
                    <div className="flex gap-3 mb-2 text-sm">
                      <span className="text-slate-300">üìû {order.phone1}</span>
                      <span className="text-slate-300">üìû {order.phone2}</span>
                    </div>
                    <div className="bg-slate-700/30 rounded-lg p-2 mb-2">
                      {order.items.map((item, idx) => (
                        <div key={idx} className="flex items-center justify-between py-1">
                          <span className="text-slate-300 text-sm">{item.name} {item.variant && `(${item.variant})`} x{item.quantity}</span>
                          <span className="text-green-400 text-xs">“Æ–ª–¥—Å—ç–Ω: {getRemainingStock(item.name, item.variant)}—à</span>
                        </div>
                      ))}
                    </div>
                    <p className="text-slate-500 text-xs">üìç {order.address}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      };

      // Orders Page
      const Orders = () => {
        const filterOrders = () => {
          let filtered = orders;
          if (orderPhoneSearch) {
            filtered = filtered.filter(o => 
              o.phone1.includes(orderPhoneSearch) || o.phone2.includes(orderPhoneSearch)
            );
          }
          return filtered;
        };

        return (
          <div className="p-4 pb-24">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-2xl font-bold text-white">–ó–∞—Ö–∏–∞–ª–≥—É—É–¥</h1>
              <button
                onClick={() => setShowAddOrder(true)}
                className="p-3 bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl text-white shadow-lg"
              >
                ‚ûï
              </button>
            </div>
            
            <input
              type="tel"
              placeholder="üìû –£—Ç–∞—Å–∞–∞—Ä —Ö–∞–π—Ö..."
              value={orderPhoneSearch}
              onChange={(e) => setOrderPhoneSearch(e.target.value.replace(/\D/g, ''))}
              className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-400 focus:border-amber-500 focus:outline-none mb-4"
            />
            
            <div className="space-y-3">
              {filterOrders().map(order => (
                <div
                  key={order.id}
                  onClick={() => setShowOrderDetail(order)}
                  className="bg-slate-800/50 rounded-xl p-4 border border-slate-700 cursor-pointer hover:border-amber-500/50"
                >
                  <div className="flex justify-between items-start mb-2">
                    <div>
                      <p className="text-white font-semibold">#{order.id}</p>
                      <p className="text-slate-400 text-sm">{order.customerName || order.phone1}</p>
                    </div>
                    <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                      order.status === 'delivered' ? 'bg-green-500/20 text-green-400' :
                      order.status === 'pickup' ? 'bg-blue-500/20 text-blue-400' :
                      order.status === 'returned' ? 'bg-orange-500/20 text-orange-400' :
                      order.status === 'cancelled' ? 'bg-red-500/20 text-red-400' :
                      'bg-yellow-500/20 text-yellow-400'
                    }`}>
                      {orderStatuses[order.status]}
                    </span>
                  </div>
                  <div className="flex justify-between items-center">
                    <p className="text-slate-400 text-sm">{order.paymentType}</p>
                    <p className="text-amber-400 font-semibold">{formatMNT(order.total)}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      };

      // Delivery Page
      const Delivery = () => {
        const deliveryOrders = orders.filter(o => 
          deliveryStatusFilter === 'all' ? true : o.status === deliveryStatusFilter
        );
        
        return (
          <div className="p-4 pb-24">
            <h1 className="text-2xl font-bold text-white mb-6">–•“Ø—Ä–≥—ç–ª—Ç</h1>
            
            <div className="flex gap-2 mb-4 overflow-x-auto pb-2">
              <button
                onClick={() => setDeliveryStatusFilter('all')}
                className={`px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap ${
                  deliveryStatusFilter === 'all' ? 'bg-amber-500 text-white' : 'bg-slate-700/50 text-slate-300'
                }`}
              >
                –ë“Ø–≥–¥
              </button>
              {Object.entries(orderStatuses).map(([key, value]) => (
                <button
                  key={key}
                  onClick={() => setDeliveryStatusFilter(key)}
                  className={`px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap ${
                    deliveryStatusFilter === key
                      ? key === 'delivered' ? 'bg-green-500 text-white' :
                        key === 'returned' ? 'bg-orange-500 text-white' :
                        key === 'cancelled' ? 'bg-red-500 text-white' :
                        'bg-yellow-500 text-white'
                      : 'bg-slate-700/50 text-slate-300'
                  }`}
                >
                  {value}
                </button>
              ))}
            </div>
            
            <div className="space-y-3">
              {deliveryOrders.map(order => (
                <div key={order.id} className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                  <div className="flex justify-between items-start mb-3">
                    <div>
                      <p className="text-white font-semibold">#{order.id}</p>
                      <p className="text-slate-300">{order.customerName || '–ù—ç—Ä–≥“Ø–π'}</p>
                    </div>
                    <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                      order.status === 'delivered' ? 'bg-green-500/20 text-green-400' :
                      order.status === 'pickup' ? 'bg-blue-500/20 text-blue-400' :
                      order.status === 'returned' ? 'bg-orange-500/20 text-orange-400' :
                      order.status === 'cancelled' ? 'bg-red-500/20 text-red-400' :
                      'bg-yellow-500/20 text-yellow-400'
                    }`}>
                      {orderStatuses[order.status]}
                    </span>
                  </div>
                  <p className="text-white text-sm mb-2">üìû {order.phone1} / {order.phone2}</p>
                  <p className="text-slate-300 text-sm mb-2">üìç {order.address}</p>
                  <div className="bg-slate-700/50 rounded-lg p-2 mb-2">
                    <p className="text-slate-400 text-xs mb-2">–ë–∞—Ä–∞–∞:</p>
                    {order.items.map((item, i) => (
                      <div key={i} className="flex items-center justify-between py-1 border-b border-slate-600 last:border-0">
                        <span className="text-white text-sm">{item.name} {item.variant && `(${item.variant})`} x{item.quantity}</span>
                        <span className="text-green-400 text-xs">“Æ–ª–¥—Å—ç–Ω: {getRemainingStock(item.name, item.variant)}—à</span>
                      </div>
                    ))}
                  </div>
                  {order.remaining > 0 && (
                    <p className="text-orange-400 font-semibold">üí∞ –ê–≤–∞—Ö: {formatMNT(order.remaining)}</p>
                  )}
                  <select
                    value={order.status}
                    onChange={(e) => updateOrderStatus(order.id, e.target.value)}
                    className="w-full mt-3 p-2 bg-slate-700 border border-slate-600 rounded-xl text-white"
                  >
                    {Object.entries(orderStatuses).map(([key, value]) => (
                      <option key={key} value={key}>{value}</option>
                    ))}
                  </select>
                </div>
              ))}
            </div>
          </div>
        );
      };

      // Inventory Page
      const Inventory = () => {
        const filteredProducts = inventory.filter(p => {
          const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
          const matchesCategory = categoryFilter === 'all' || p.category === categoryFilter;
          return matchesSearch && matchesCategory;
        });

        return (
          <div className="p-4 pb-24">
            <div className="flex justify-between items-center mb-6">
              <h1 className="text-2xl font-bold text-white">–ê–≥—É—É–ª–∞—Ö</h1>
              <button
                onClick={() => setShowAddProduct(true)}
                className="p-3 bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl text-white"
              >
                ‚ûï
              </button>
            </div>

            <input
              type="text"
              placeholder="üîç –ë–∞—Ä–∞–∞ —Ö–∞–π—Ö..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-400 focus:border-amber-500 focus:outline-none mb-4"
            />

            <div className="flex gap-2 mb-4 overflow-x-auto pb-2">
              {categories.map(cat => (
                <button
                  key={cat}
                  onClick={() => setCategoryFilter(cat)}
                  className={`px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap ${
                    categoryFilter === cat ? 'bg-amber-500 text-white' : 'bg-slate-700/50 text-slate-300'
                  }`}
                >
                  {cat === 'all' ? '–ë“Ø–≥–¥' : cat}
                </button>
              ))}
            </div>

            <div className="grid grid-cols-2 gap-4">
              {filteredProducts.map(product => (
                <div key={product.id} className="bg-slate-800/50 rounded-xl border border-slate-700 overflow-hidden">
                  <div className="p-3">
                    <h3 className="text-white font-semibold text-sm truncate">{product.name}</h3>
                    <p className="text-slate-400 text-xs">{product.category}</p>
                    <p className="text-amber-400 font-bold mt-1">{formatMNT(product.price)}</p>
                    <div className="flex justify-between items-center mt-1">
                      <span className={`text-sm ${product.stock > 5 ? 'text-green-400' : 'text-orange-400'}`}>
                        {product.stock} —à–∏—Ä—Ö—ç–≥
                      </span>
                      <button
                        onClick={() => setShowEditProduct(product)}
                        className="px-2 py-1 bg-slate-700 text-white rounded-lg text-xs hover:bg-slate-600"
                      >
                        ‚úèÔ∏è –ó–∞—Å–∞—Ö
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      };

      // Settings Page
      const SettingsPage = () => {
        const stats = getStatistics();
        
        return (
          <div className="p-4 pb-24">
            <h1 className="text-2xl font-bold text-white mb-6">–¢–æ—Ö–∏—Ä–≥–æ–æ</h1>
            
            <div className="bg-slate-800/50 rounded-xl p-4 border border-amber-500/30 mb-4">
              <h3 className="text-lg font-semibold text-white mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫</h3>
              
              <div className="flex gap-2 mb-4">
                {[{ key: 'daily', label: '”®–Ω”©”©–¥”©—Ä' }, { key: 'weekly', label: '7 —Ö–æ–Ω–æ–≥' }, { key: 'monthly', label: '–°–∞—Ä' }].map(({ key, label }) => (
                  <button
                    key={key}
                    onClick={() => setStatisticsPeriod(key)}
                    className={`px-3 py-2 rounded-xl text-sm font-medium ${
                      statisticsPeriod === key ? 'bg-amber-500 text-white' : 'bg-slate-700/50 text-slate-300'
                    }`}
                  >
                    {label}
                  </button>
                ))}
              </div>
              
              <div className="grid grid-cols-2 gap-3">
                <div className="bg-amber-500/20 rounded-xl p-3 border border-amber-500/30">
                  <p className="text-amber-300 text-xs">–ë–æ—Ä–ª—É—É–ª–∞–ª—Ç</p>
                  <p className="text-xl font-bold text-white">{formatMNT(stats.totalSales)}</p>
                </div>
                <div className="bg-blue-500/20 rounded-xl p-3 border border-blue-500/30">
                  <p className="text-blue-300 text-xs">–ó–∞—Ö–∏–∞–ª–≥–∞</p>
                  <p className="text-xl font-bold text-white">{stats.totalOrders}</p>
                </div>
                <div className="bg-green-500/20 rounded-xl p-3 border border-green-500/30">
                  <p className="text-green-300 text-xs">–•“Ø—Ä–≥—ç—Å—ç–Ω</p>
                  <p className="text-xl font-bold text-white">{stats.deliveredOrders}</p>
                </div>
                <div className="bg-red-500/20 rounded-xl p-3 border border-red-500/30">
                  <p className="text-red-300 text-xs">–ê–≤–ª–∞–≥–∞</p>
                  <p className="text-xl font-bold text-white">{formatMNT(stats.pendingPayment)}</p>
                </div>
              </div>
            </div>
            
            <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
              <h3 className="text-lg font-semibold text-white mb-4">üîê –ù—É—É—Ü “Ø–≥: 1234</h3>
              <p className="text-slate-400 text-sm">Telegram Bot –±–æ–ª–æ–Ω –±—É—Å–∞–¥ —Ç–æ—Ö–∏—Ä–≥–æ–æ–≥ code –¥—ç—ç—Ä ”©”©—Ä—á–∏–ª–Ω”© “Ø“Ø.</p>
            </div>
          </div>
        );
      };

      // Order Detail Modal
      const OrderDetailModal = () => {
        const order = showOrderDetail;
        if (!order) return null;

        const printReceipt = () => {
          const itemsHtml = order.items.map(item => {
            const variantText = item.variant ? '(' + item.variant + ')' : '';
            const priceText = formatMNT(item.price * item.quantity);
            return '<div style="display:flex;justify-content:space-between;margin:5px 0"><span>' + item.name + ' ' + variantText + ' x' + item.quantity + '</span><span>' + priceText + '</span></div>';
          }).join('');
          
          const now = new Date();
          const dateTime = now.toLocaleDateString('mn-MN') + ' ' + now.toLocaleTimeString('mn-MN', { hour: '2-digit', minute: '2-digit' });
          
          const balanceHtml = order.remaining > 0 ? '<div style="display:flex;justify-content:space-between;margin-top:5px;font-weight:bold"><span>“Æ–õ–î–≠–ì–î–≠–õ:</span><span>' + formatMNT(order.remaining) + '</span></div>' : '';
          const depositHtml = order.deposit > 0 ? '<p><b>–£—Ä—å–¥—á–∏–ª–≥–∞–∞:</b> ' + formatMNT(order.deposit) + '</p>' : '';
          
          const receiptContent = '<html><head><title>–ë–∞—Ä–∏–º—Ç #' + order.id + '</title><style>body{font-family:monospace;padding:20px;max-width:300px;margin:0 auto;font-size:12px}h1{text-align:center;font-size:16px;margin-bottom:5px}h2{text-align:center;font-size:10px;font-weight:normal;margin:0}hr{border:none;border-top:1px dashed #000;margin:10px 0}.total{font-weight:bold;font-size:14px}</style></head><body><h1>Aspen Homestore</h1><h2>–•–£–î, 11 —Ö–æ—Ä–æ–æ, SEVEN STAR —Ö—É–¥–∞–ª–¥–∞–∞–Ω—ã —Ç”©–≤–∏–π–Ω 1 –¥–∞–≤—Ö–∞—Ä—Ç, 1.42 —Ç–æ–æ—Ç</h2><p style="text-align:center;margin:5px 0">üìû +976 99778513</p><p style="text-align:center;margin-top:10px">–ë–∞—Ä–∏–º—Ç #' + order.id + '</p><p style="text-align:center;font-size:11px">' + dateTime + '</p><hr><p><b>–•–∞—Ä–∏–ª—Ü–∞–≥—á:</b> ' + (order.customerName || '–ù—ç—Ä–≥“Ø–π') + '</p><p><b>–£—Ç–∞—Å:</b> ' + order.phone1 + '</p><p><b>–•–∞—è–≥:</b> ' + order.address + '</p><hr><b>–ë–∞—Ä–∞–∞:</b>' + itemsHtml + '<hr><div class="total" style="display:flex;justify-content:space-between"><span>–ù–ò–ô–¢:</span><span>' + formatMNT(order.total) + '</span></div><p><b>–¢”©–ª–±”©—Ä:</b> ' + order.paymentType + '</p>' + depositHtml + balanceHtml + '<hr><p style="text-align:center;font-weight:bold">–ú–ê–ù–ê–ô–•–ê–ê–† “Æ–ô–õ–ß–õ“Æ“Æ–õ–°–≠–ù–î –ë–ê–Ø–†–õ–ê–õ–ê–ê</p><p style="text-align:center;margin-top:5px;font-size:10px">–ê–º–µ—Ä–∏–∫ –∑–∞–≥–≤–∞—Ä—ã–Ω –±“Ø—Ö —Ç”©—Ä–ª–∏–π–Ω —Ç–∞–≤–∏–ª–≥—ã–≥ aspen.mn - —ç—ç—Å</p></body></html>';
          
          const printWindow = window.open('', '_blank');
          printWindow.document.write(receiptContent);
          printWindow.document.close();
          setTimeout(() => printWindow.print(), 250);
        };

        return (
          <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 overflow-y-auto">
            <div className="min-h-full flex items-start justify-center p-4 py-8">
              <div className="bg-slate-800 rounded-2xl p-5 w-full max-w-md border border-amber-500/20 shadow-2xl">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-bold text-white">–ó–∞—Ö–∏–∞–ª–≥–∞ #{order.id}</h3>
                  <button onClick={() => setShowOrderDetail(null)} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>
                
                <div className="space-y-4">
                  <div className="bg-slate-700/50 rounded-xl p-4">
                    <p className="text-slate-400 text-sm">–•–∞—Ä–∏–ª—Ü–∞–≥—á</p>
                    <p className="text-white font-semibold">{order.customerName || '–ù—ç—Ä–≥“Ø–π'}</p>
                    <p className="text-white">üìû {order.phone1}</p>
                    <p className="text-white">üìû {order.phone2}</p>
                    <p className="text-slate-300 mt-2">üìç {order.address}</p>
                  </div>
                  
                  <div className="bg-slate-700/50 rounded-xl p-4">
                    <p className="text-slate-400 text-sm mb-2">–ë–∞—Ä–∞–∞</p>
                    {order.items.map((item, i) => (
                      <div key={i} className="flex items-center gap-3 py-2 border-b border-slate-600 last:border-0">
                        <div className="flex-1">
                          <p className="text-white text-sm">{item.name} {item.variant && `(${item.variant})`}</p>
                          <p className="text-slate-400 text-xs">x{item.quantity}</p>
                        </div>
                        <div className="text-right">
                          <span className="text-amber-400 font-semibold">{formatMNT(item.price * item.quantity)}</span>
                          <p className="text-green-400 text-xs">“Æ–ª–¥—Å—ç–Ω: {getRemainingStock(item.name, item.variant)}—à</p>
                        </div>
                      </div>
                    ))}
                    <div className="border-t border-slate-600 mt-2 pt-2 flex justify-between text-amber-400 font-semibold">
                      <span>–ù–∏–π—Ç:</span>
                      <span>{formatMNT(order.total)}</span>
                    </div>
                  </div>
                  
                  <div className="bg-slate-700/50 rounded-xl p-4">
                    <p className="text-slate-400 text-sm">–¢”©–ª–±”©—Ä: {order.paymentType}</p>
                    {order.remaining > 0 && (
                      <div>
                        <p className="text-orange-400 font-semibold mt-1">“Æ–ª–¥—ç–≥–¥—ç–ª: {formatMNT(order.remaining)}</p>
                        <button
                          onClick={() => {
                            if (confirm('–¢”©–ª–±”©—Ä –±“Ø—Ä—ç–Ω —Ç”©–ª”©–≥–¥—Å”©–Ω “Ø“Ø? (' + formatMNT(order.remaining) + ')')) {
                              const newOrders = orders.map(o => 
                                o.id === order.id ? { ...o, remaining: 0, deposit: o.total } : o
                              );
                              saveOrders(newOrders);
                              setShowOrderDetail({ ...order, remaining: 0 });
                            }
                          }}
                          className="w-full mt-2 p-2 bg-green-500/20 text-green-400 rounded-lg font-semibold border border-green-500/30 hover:bg-green-500/30"
                        >
                          üíµ –¢”©–ª–±”©—Ä –∞–≤—Å–∞–Ω
                        </button>
                      </div>
                    )}
                    {order.remaining === 0 && order.total > 0 && (
                      <p className="text-green-400 font-semibold mt-1">‚úÖ –¢”©–ª–±”©—Ä –±“Ø—Ä—ç–Ω —Ç”©–ª”©–≥–¥—Å”©–Ω</p>
                    )}
                  </div>
                  
                  {order.note && (
                    <div className="bg-slate-700/50 rounded-xl p-4">
                      <p className="text-slate-400 text-sm">–¢—ç–º–¥—ç–≥–ª—ç–ª</p>
                      <p className="text-white">{order.note}</p>
                    </div>
                  )}
                  
                  {order.status === 'delivered' && (
                    <button
                      onClick={() => setShowReturnModal(order)}
                      className="w-full p-3 bg-orange-500/20 text-orange-400 rounded-xl font-semibold border border-orange-500/30"
                    >
                      üîÑ –ë—É—Ü–∞–∞–ª—Ç —Ö–∏–π—Ö
                    </button>
                  )}
                  
                  <select
                    value={order.status}
                    onChange={(e) => {
                      updateOrderStatus(order.id, e.target.value);
                      setShowOrderDetail({ ...order, status: e.target.value });
                    }}
                    className="w-full p-3 bg-slate-600 border border-slate-500 rounded-xl text-white"
                  >
                    {Object.entries(orderStatuses).map(([key, value]) => (
                      <option key={key} value={key}>{value}</option>
                    ))}
                  </select>
                </div>
                
                <div className="flex gap-3 mt-4">
                  <button onClick={printReceipt} className="flex-1 p-3 bg-slate-700 text-white rounded-xl font-semibold">
                    üñ®Ô∏è –•—ç–≤–ª—ç—Ö
                  </button>
                  <button onClick={() => setShowOrderDetail(null)} className="flex-1 p-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold">
                    –•–∞–∞—Ö
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Add Order Modal
      const AddOrderModal = () => {
        const [formData, setFormData] = useState({
          customerName: '', phone1: '', phone2: '', items: [], paymentType: '–¢”©–ª–±”©—Ä 100% —Ç”©–ª—Å”©–Ω',
          deposit: '', address: '', note: '', isPickup: false
        });
        const [selectedProduct, setSelectedProduct] = useState('');
        const [selectedVariant, setSelectedVariant] = useState('');
        const [quantity, setQuantity] = useState(1);
        const [applyDiscount, setApplyDiscount] = useState(false);
        const [productSearch, setProductSearch] = useState('');
        const [productCategory, setProductCategory] = useState('all');

        const currentProduct = selectedProduct ? inventory.find(p => p.id === parseInt(selectedProduct)) : null;
        const hasVariants = currentProduct && currentProduct.variants && currentProduct.variants.length > 0;
        
        // Filter products by search and category
        const filteredInventory = inventory.filter(p => {
          const matchesSearch = p.name.toLowerCase().includes(productSearch.toLowerCase());
          const matchesCategory = productCategory === 'all' || p.category === productCategory;
          return matchesSearch && matchesCategory;
        });

        const addItem = () => {
          if (selectedProduct) {
            const product = inventory.find(p => p.id === parseInt(selectedProduct));
            if (product) {
              if (hasVariants && !selectedVariant) {
                alert('–•—É–≤–∏–ª–±–∞—Ä —Å–æ–Ω–≥–æ–Ω–æ —É—É');
                return;
              }
              
              // Get price from variant if exists, otherwise use base price
              let basePrice = product.price;
              if (hasVariants && selectedVariant) {
                const variant = product.variants.find(v => v.size === selectedVariant);
                if (variant && variant.price) {
                  basePrice = variant.price;
                }
              }
              
              const itemPrice = applyDiscount ? Math.round(basePrice * 0.9) : basePrice;
              setFormData(prev => ({
                ...prev,
                items: [...prev.items, {
                  productId: product.id,
                  name: product.name,
                  image: product.image,
                  variant: hasVariants ? selectedVariant : null,
                  quantity: quantity,
                  price: itemPrice,
                  discount: applyDiscount
                }]
              }));
              setSelectedProduct('');
              setSelectedVariant('');
              setQuantity(1);
              setApplyDiscount(false);
            }
          }
        };

        const calculateTotal = () => formData.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);

        const handleSubmit = () => {
          if (formData.phone1.length !== 8 || formData.phone2.length !== 8) {
            alert('–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä 8 –æ—Ä–æ–Ω—Ç–æ–π –±–∞–π—Ö —ë—Å—Ç–æ–π');
            return;
          }
          if (formData.items.length === 0) {
            alert('–ë–∞—Ä–∞–∞ –Ω—ç–º–Ω—ç “Ø“Ø');
            return;
          }

          const total = calculateTotal();
          const deposit = formData.paymentType === '–£—Ä—å–¥—á–∏–ª–≥–∞–∞ ”©–≥—Å”©–Ω' ? parseInt(formData.deposit) || 0 : 0;
          const remaining = formData.paymentType === '–£—Ä—å–¥—á–∏–ª–≥–∞–∞ ”©–≥—Å”©–Ω' ? total - deposit :
                            formData.paymentType === '–•“Ø—Ä–≥—ç—Å–Ω–∏–π –¥–∞—Ä–∞–∞ —Ç”©–ª–Ω”©' ? total : 0;

          // Generate order ID: YYMM + order number for that month (01, 02, etc.)
          const now = new Date();
          const yearMonth = String(now.getFullYear()).slice(2) + String(now.getMonth() + 1).padStart(2, '0');
          
          // Count orders from current month
          const currentMonthOrders = orders.filter(o => {
            const orderDate = new Date(o.date);
            return orderDate.getFullYear() === now.getFullYear() && orderDate.getMonth() === now.getMonth();
          });
          const monthlyOrderNum = String(currentMonthOrders.length + 1).padStart(2, '0');
          
          const newOrder = {
            id: yearMonth + monthlyOrderNum,
            customerName: formData.customerName,
            phone1: formData.phone1,
            phone2: formData.phone2,
            items: formData.items,
            paymentType: formData.paymentType,
            address: formData.address,
            note: formData.note,
            total,
            deposit,
            remaining,
            status: formData.isPickup ? 'pickup' : 'pending',
            date: new Date().toISOString().split('T')[0]
          };

          // If pickup, reduce inventory immediately
          if (formData.isPickup) {
            let newInventory = [...inventory];
            formData.items.forEach(item => {
              newInventory = newInventory.map(product => {
                if (product.id === item.productId) {
                  if (item.variant && product.variants && product.variants.length > 0) {
                    return {
                      ...product,
                      stock: product.stock - item.quantity,
                      variants: product.variants.map(v => 
                        v.size === item.variant ? { ...v, stock: v.stock - item.quantity } : v
                      )
                    };
                  }
                  return { ...product, stock: product.stock - item.quantity };
                }
                return product;
              });
            });
            saveInventory(newInventory);
          }

          saveOrders([newOrder, ...orders]);
          setShowAddOrder(false);
        };

        if (!showAddOrder) return null;

        return (
          <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 overflow-y-auto">
            <div className="min-h-full flex items-start justify-center p-4 py-8">
              <div className="bg-slate-800 rounded-2xl p-5 w-full max-w-md border border-amber-500/20 shadow-2xl">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-bold text-white">–®–∏–Ω—ç –∑–∞—Ö–∏–∞–ª–≥–∞</h3>
                  <button onClick={() => setShowAddOrder(false)} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>
                
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="–ù—ç—Ä (–∑–∞–∞–≤–∞–ª –±–∏—à)"
                    value={formData.customerName}
                    onChange={(e) => setFormData(prev => ({ ...prev, customerName: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                  />
                  
                  <div className="grid grid-cols-2 gap-3">
                    <input
                      type="tel"
                      placeholder="–£—Ç–∞—Å 1 (8 –æ—Ä–æ–Ω) *"
                      value={formData.phone1}
                      onChange={(e) => setFormData(prev => ({ ...prev, phone1: e.target.value.replace(/\D/g, '').slice(0, 8) }))}
                      className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                    />
                    <input
                      type="tel"
                      placeholder="–£—Ç–∞—Å 2 (8 –æ—Ä–æ–Ω) *"
                      value={formData.phone2}
                      onChange={(e) => setFormData(prev => ({ ...prev, phone2: e.target.value.replace(/\D/g, '').slice(0, 8) }))}
                      className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                    />
                  </div>
                  
                  {/* Store pickup checkbox */}
                  <label className="flex items-center gap-3 bg-blue-500/10 border border-blue-500/30 rounded-xl p-3 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={formData.isPickup}
                      onChange={(e) => setFormData(prev => ({ ...prev, isPickup: e.target.checked, address: e.target.checked ? '–î—ç–ª–≥“Ø“Ø—Ä—ç—ç—Å –∞–≤—Å–∞–Ω' : '' }))}
                      className="w-5 h-5 rounded accent-blue-500"
                    />
                    <span className="text-blue-400">üè™ –î—ç–ª–≥“Ø“Ø—Ä—ç—ç—Å –∞–≤–Ω–∞ (—Ö“Ø—Ä–≥—ç–ª—Ç —à–∞–∞—Ä–¥–ª–∞–≥–∞–≥“Ø–π)</span>
                  </label>
                  
                  {!formData.isPickup && (
                    <textarea
                      placeholder="–•“Ø—Ä–≥—ç—Ö —Ö–∞—è–≥"
                      value={formData.address}
                      onChange={(e) => setFormData(prev => ({ ...prev, address: e.target.value }))}
                      className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 h-20"
                    />
                  )}
                  
                  <div className="border border-slate-600 rounded-xl p-3">
                    <p className="text-amber-400 text-sm mb-2">–ë–∞—Ä–∞–∞ –Ω—ç–º—ç—Ö</p>
                    
                    {/* Search and Category Filter */}
                    <div className="flex gap-2 mb-2">
                      <input
                        type="text"
                        placeholder="üîç –•–∞–π—Ö..."
                        value={productSearch}
                        onChange={(e) => setProductSearch(e.target.value)}
                        className="flex-1 p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white text-sm placeholder-slate-400"
                      />
                      <select
                        value={productCategory}
                        onChange={(e) => setProductCategory(e.target.value)}
                        className="p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white text-sm"
                      >
                        <option value="all">–ë“Ø–≥–¥</option>
                        {categories.filter(c => c !== 'all').map(cat => (
                          <option key={cat} value={cat}>{cat}</option>
                        ))}
                      </select>
                    </div>
                    
                    <select
                      value={selectedProduct}
                      onChange={(e) => { setSelectedProduct(e.target.value); setSelectedVariant(''); }}
                      className="w-full p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white mb-2"
                    >
                      <option value="">–ë–∞—Ä–∞–∞ —Å–æ–Ω–≥–æ—Ö ({filteredInventory.length})</option>
                      {filteredInventory.map(p => (
                        <option key={p.id} value={p.id}>{p.name} - {formatMNT(p.price)} (“Æ–ª–¥—Å—ç–Ω: {p.stock}—à)</option>
                      ))}
                    </select>
                    
                    {/* Selected product preview */}
                    {selectedProduct && (
                      <div className="flex items-center justify-between mb-2 bg-slate-700/30 rounded-lg p-2">
                        <span className="text-white text-sm">{inventory.find(p => p.id === parseInt(selectedProduct))?.name}</span>
                        <span className="text-green-400 text-sm">“Æ–ª–¥—Å—ç–Ω: {inventory.find(p => p.id === parseInt(selectedProduct))?.stock}—à</span>
                      </div>
                    )}
                    
                    {/* Variant selection */}
                    {hasVariants && (
                      <div className="mb-2">
                        <p className="text-slate-400 text-xs mb-1">–•—É–≤–∏–ª–±–∞—Ä —Å–æ–Ω–≥–æ—Ö:</p>
                        <div className="flex flex-wrap gap-2">
                          {currentProduct.variants.map((v, i) => (
                            <button
                              key={i}
                              onClick={() => setSelectedVariant(v.size)}
                              className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                selectedVariant === v.size 
                                  ? 'bg-amber-500 text-white' 
                                  : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                              }`}
                            >
                              <div>{v.size}</div>
                              <div className="text-xs">{v.price ? formatMNT(v.price) : ''}</div>
                              <div className="text-xs text-green-400">“Æ–ª–¥—Å—ç–Ω: {v.stock}—à</div>
                            </button>
                          ))}
                        </div>
                      </div>
                    )}
                    
                    <div className="flex gap-2 items-center">
                      <input
                        type="number"
                        min="1"
                        value={quantity}
                        onChange={(e) => setQuantity(parseInt(e.target.value) || 1)}
                        className="w-16 p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white"
                      />
                      <label className="flex items-center gap-2 text-white text-sm">
                        <input
                          type="checkbox"
                          checked={applyDiscount}
                          onChange={(e) => setApplyDiscount(e.target.checked)}
                        />
                        10% —Ö—è–º–¥—Ä–∞–ª
                      </label>
                      <button onClick={addItem} className="ml-auto p-2 bg-amber-500 rounded-lg text-white">–ù—ç–º—ç—Ö</button>
                    </div>
                    
                    {formData.items.length > 0 && (
                      <div className="mt-3 border-t border-slate-600 pt-3 space-y-2">
                        {formData.items.map((item, i) => (
                          <div key={i} className="flex items-center gap-2 bg-slate-700/30 rounded-lg p-2">
                            <div className="flex-1">
                              <p className="text-white text-sm">{item.name} x{item.quantity} {item.discount && <span className="text-green-400">(-10%)</span>}</p>
                              <p className="text-amber-400 text-xs">{formatMNT(item.price * item.quantity)}</p>
                            </div>
                            <button onClick={() => setFormData(prev => ({ ...prev, items: prev.items.filter((_, idx) => idx !== i) }))} className="text-red-400 text-lg">√ó</button>
                          </div>
                        ))}
                        <div className="text-right text-amber-400 font-semibold mt-2">
                          –ù–∏–π—Ç: {formatMNT(calculateTotal())}
                        </div>
                      </div>
                    )}
                  </div>
                  
                  <select
                    value={formData.paymentType}
                    onChange={(e) => setFormData(prev => ({ ...prev, paymentType: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white"
                  >
                    {paymentTypes.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                  
                  {formData.paymentType === '–£—Ä—å–¥—á–∏–ª–≥–∞–∞ ”©–≥—Å”©–Ω' && (
                    <input
                      type="number"
                      placeholder="–£—Ä—å–¥—á–∏–ª–≥–∞–∞ –¥“Ø–Ω (‚ÇÆ)"
                      value={formData.deposit}
                      onChange={(e) => setFormData(prev => ({ ...prev, deposit: e.target.value }))}
                      className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                    />
                  )}
                  
                  <textarea
                    placeholder="–¢—ç–º–¥—ç–≥–ª—ç–ª"
                    value={formData.note}
                    onChange={(e) => setFormData(prev => ({ ...prev, note: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 h-16"
                  />
                </div>
                
                <div className="flex gap-3 mt-4">
                  <button onClick={() => setShowAddOrder(false)} className="flex-1 p-3 bg-slate-700 text-white rounded-xl">–ë–æ–ª–∏—Ö</button>
                  <button onClick={handleSubmit} className="flex-1 p-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold">“Æ“Ø—Å–≥—ç—Ö</button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Add Product Modal
      const AddProductModal = () => {
        const [formData, setFormData] = useState({ name: '', category: '–ó–æ—á–Ω—ã ”©—Ä”©”©', price: '', stock: '', image: '' });
        const [hasVariants, setHasVariants] = useState(false);
        const [variants, setVariants] = useState([]);
        const [newVariant, setNewVariant] = useState({ name: '', stock: '', price: '' });

        const addVariant = () => {
          if (newVariant.name && newVariant.stock && newVariant.price) {
            setVariants(prev => [...prev, { size: newVariant.name, stock: parseInt(newVariant.stock), price: parseInt(newVariant.price) }]);
            setNewVariant({ name: '', stock: '', price: '' });
          } else {
            alert('–ù—ç—Ä, —Ç–æ–æ, “Ø–Ω—ç –±“Ø–≥–¥–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É');
          }
        };

        const removeVariant = (index) => {
          setVariants(prev => prev.filter((_, i) => i !== index));
        };

        const totalStock = hasVariants 
          ? variants.reduce((sum, v) => sum + v.stock, 0) 
          : parseInt(formData.stock) || 0;

        const handleSubmit = () => {
          if (!formData.name) {
            alert('–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä –æ—Ä—É—É–ª–Ω–∞ —É—É');
            return;
          }
          
          let newProduct;
          if (hasVariants) {
            if (variants.length === 0) {
              alert('–•—É–≤–∏–ª–±–∞—Ä –Ω—ç–º–Ω—ç “Ø“Ø');
              return;
            }
            const basePrice = variants[0].price;
            newProduct = {
              id: Date.now(),
              name: formData.name,
              category: formData.category,
              price: basePrice,
              stock: totalStock,
              image: formData.image || '',
              variants: variants
            };
          } else {
            if (!formData.stock || !formData.price) {
              alert('“Æ–Ω—ç –±–æ–ª–æ–Ω —Ç–æ–æ —à–∏—Ä—Ö—ç–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É');
              return;
            }
            newProduct = {
              id: Date.now(),
              name: formData.name,
              category: formData.category,
              price: parseInt(formData.price),
              stock: parseInt(formData.stock),
              image: formData.image || '',
              variants: []
            };
          }
          
          saveInventory([...inventory, newProduct]);
          setShowAddProduct(false);
          setFormData({ name: '', category: '–ó–æ—á–Ω—ã ”©—Ä”©”©', price: '', stock: '', image: '' });
          setHasVariants(false);
          setVariants([]);
        };

        if (!showAddProduct) return null;

        return (
          <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 overflow-y-auto">
            <div className="min-h-full flex items-start justify-center p-4 py-8">
              <div className="bg-slate-800 rounded-2xl p-5 w-full max-w-sm border border-amber-500/20 shadow-2xl">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-bold text-white">–®–∏–Ω—ç –±–∞—Ä–∞–∞</h3>
                  <button onClick={() => setShowAddProduct(false)} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>
                
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä"
                    value={formData.name}
                    onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                  />
                  <select
                    value={formData.category}
                    onChange={(e) => setFormData(prev => ({ ...prev, category: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white"
                  >
                    {categories.filter(c => c !== 'all').map(cat => (
                      <option key={cat} value={cat}>{cat}</option>
                    ))}
                  </select>
                  
                  {/* Variant toggle */}
                  <div className="bg-slate-700/30 rounded-xl p-3 border border-slate-600">
                    <label className="flex items-center gap-3 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={hasVariants}
                        onChange={(e) => setHasVariants(e.target.checked)}
                        className="w-5 h-5 rounded accent-amber-500"
                      />
                      <span className="text-white">–≠–Ω—ç –±–∞—Ä–∞–∞ —Ö—É–≤–∏–ª–±–∞—Ä—Ç–∞–π —é—É?</span>
                    </label>
                    <p className="text-slate-400 text-xs mt-1">–ñ–∏—à—ç—ç: ”®–Ω–≥”©, –•—ç–º–∂—ç—ç, –ú–∞—Ç–µ—Ä–∏–∞–ª (—Ö—É–≤–∏–ª–±–∞—Ä –±“Ø—Ä ”©”©—Ä “Ø–Ω—ç—Ç—ç–π –±–∞–π–∂ –±–æ–ª–Ω–æ)</p>
                  </div>
                  
                  {/* Without variants - simple price and stock input */}
                  {!hasVariants && (
                    <div className="space-y-3">
                      <input
                        type="number"
                        placeholder="“Æ–Ω—ç (‚ÇÆ)"
                        value={formData.price}
                        onChange={(e) => setFormData(prev => ({ ...prev, price: e.target.value }))}
                        className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                      />
                      <input
                        type="number"
                        placeholder="–¢–æ–æ —à–∏—Ä—Ö—ç–≥"
                        value={formData.stock}
                        onChange={(e) => setFormData(prev => ({ ...prev, stock: e.target.value }))}
                        className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                      />
                    </div>
                  )}
                  
                  {/* With variants */}
                  {hasVariants && (
                    <div className="bg-slate-700/30 rounded-xl p-3 border border-slate-600">
                      <p className="text-amber-400 text-sm mb-2">–•—É–≤–∏–ª–±–∞—Ä—É—É–¥</p>
                      
                      {/* Variant list */}
                      {variants.length > 0 && (
                        <div className="space-y-2 mb-3">
                          {variants.map((v, i) => (
                            <div key={i} className="flex items-center justify-between bg-slate-800/50 rounded-lg p-2">
                              <span className="text-white">{v.size}</span>
                              <div className="flex items-center gap-3">
                                <span className="text-amber-400">{formatMNT(v.price)}</span>
                                <span className="text-slate-300">{v.stock} —à</span>
                                <button onClick={() => removeVariant(i)} className="text-red-400 hover:text-red-300">‚úï</button>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                      
                      {/* Add new variant */}
                      <div className="space-y-2">
                        <div className="flex gap-2">
                          <input
                            type="text"
                            placeholder="–ù—ç—Ä (–∂–∏—à—ç—ç: –£–ª–∞–∞–Ω)"
                            value={newVariant.name}
                            onChange={(e) => setNewVariant(prev => ({ ...prev, name: e.target.value }))}
                            className="flex-1 p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 text-sm"
                          />
                        </div>
                        <div className="flex gap-2">
                          <input
                            type="number"
                            placeholder="“Æ–Ω—ç (‚ÇÆ)"
                            value={newVariant.price}
                            onChange={(e) => setNewVariant(prev => ({ ...prev, price: e.target.value }))}
                            className="flex-1 p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 text-sm"
                          />
                          <input
                            type="number"
                            placeholder="–¢–æ–æ"
                            value={newVariant.stock}
                            onChange={(e) => setNewVariant(prev => ({ ...prev, stock: e.target.value }))}
                            className="w-20 p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 text-sm"
                          />
                          <button onClick={addVariant} className="p-2 bg-amber-500 rounded-lg text-white">‚ûï</button>
                        </div>
                      </div>
                      
                      {variants.length > 0 && (
                        <p className="text-green-400 text-sm mt-2">–ù–∏–π—Ç: {totalStock} —à–∏—Ä—Ö—ç–≥</p>
                      )}
                    </div>
                  )}
                </div>
                
                <div className="flex gap-3 mt-4">
                  <button onClick={() => setShowAddProduct(false)} className="flex-1 p-3 bg-slate-700 text-white rounded-xl">–ë–æ–ª–∏—Ö</button>
                  <button onClick={handleSubmit} className="flex-1 p-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold">–•–∞–¥–≥–∞–ª–∞—Ö</button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Edit Product Modal
      const EditProductModal = () => {
        const product = showEditProduct;
        const [formData, setFormData] = useState({ name: '', category: '', price: '', stock: '', image: '' });
        
        useEffect(() => {
          if (product) {
            setFormData({
              name: product.name,
              category: product.category,
              price: product.price.toString(),
              stock: product.stock.toString(),
              image: product.image
            });
          }
        }, [product]);

        const handleSubmit = () => {
          if (formData.name && formData.price && formData.stock) {
            const newInventory = inventory.map(p => 
              p.id === product.id 
                ? { ...p, name: formData.name, category: formData.category, price: parseInt(formData.price), stock: parseInt(formData.stock), image: formData.image }
                : p
            );
            saveInventory(newInventory);
            setShowEditProduct(null);
          }
        };

        const handleDelete = () => {
          if (confirm('–≠–Ω—ç –±–∞—Ä–∞–∞–≥ —É—Å—Ç–≥–∞—Ö —É—É?')) {
            saveInventory(inventory.filter(p => p.id !== product.id));
            setShowEditProduct(null);
          }
        };

        if (!product) return null;

        return (
          <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 overflow-y-auto">
            <div className="min-h-full flex items-start justify-center p-4 py-8">
              <div className="bg-slate-800 rounded-2xl p-5 w-full max-w-sm border border-amber-500/20 shadow-2xl">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-bold text-white">–ë–∞—Ä–∞–∞ –∑–∞—Å–∞—Ö</h3>
                  <button onClick={() => setShowEditProduct(null)} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>
                
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="–ë–∞—Ä–∞–∞–Ω—ã –Ω—ç—Ä"
                    value={formData.name}
                    onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                  />
                  <select
                    value={formData.category}
                    onChange={(e) => setFormData(prev => ({ ...prev, category: e.target.value }))}
                    className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white"
                  >
                    {categories.filter(c => c !== 'all').map(cat => (
                      <option key={cat} value={cat}>{cat}</option>
                    ))}
                  </select>
                  <div className="grid grid-cols-2 gap-3">
                    <input
                      type="number"
                      placeholder="“Æ–Ω—ç (‚ÇÆ)"
                      value={formData.price}
                      onChange={(e) => setFormData(prev => ({ ...prev, price: e.target.value }))}
                      className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                    />
                    <input
                      type="number"
                      placeholder="–¢–æ–æ —à–∏—Ä—Ö—ç–≥"
                      value={formData.stock}
                      onChange={(e) => setFormData(prev => ({ ...prev, stock: e.target.value }))}
                      className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400"
                    />
                  </div>
                </div>
                
                <div className="flex gap-3 mt-4">
                  <button onClick={handleDelete} className="p-3 bg-red-500/20 text-red-400 rounded-xl border border-red-500/30">üóëÔ∏è</button>
                  <button onClick={() => setShowEditProduct(null)} className="flex-1 p-3 bg-slate-700 text-white rounded-xl">–ë–æ–ª–∏—Ö</button>
                  <button onClick={handleSubmit} className="flex-1 p-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold">–•–∞–¥–≥–∞–ª–∞—Ö</button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Return Modal
      const ReturnModal = () => {
        const order = showReturnModal;
        const [returnItems, setReturnItems] = useState(
          order.items.map(item => ({
            ...item,
            selected: false,
            returnQty: item.quantity
          }))
        );
        const [returnNote, setReturnNote] = useState('');

        const toggleItem = (index) => {
          setReturnItems(prev => prev.map((item, i) => 
            i === index ? { ...item, selected: !item.selected } : item
          ));
        };

        const updateQty = (index, delta) => {
          setReturnItems(prev => prev.map((item, i) => {
            if (i === index) {
              const newQty = Math.max(1, Math.min(item.quantity, item.returnQty + delta));
              return { ...item, returnQty: newQty };
            }
            return item;
          }));
        };

        const selectedItems = returnItems.filter(item => item.selected);
        const refundTotal = selectedItems.reduce((sum, item) => sum + (item.price * item.returnQty), 0);

        const handleReturn = () => {
          if (selectedItems.length === 0) {
            alert('–ë—É—Ü–∞–∞—Ö –±–∞—Ä–∞–∞ —Å–æ–Ω–≥–æ–Ω–æ —É—É');
            return;
          }
          
          if (!confirm('–¢–∞ ' + selectedItems.length + ' –±–∞—Ä–∞–∞ –±—É—Ü–∞–∞—Ö–¥–∞–∞ –∏—Ç–≥—ç–ª—Ç—ç–π –±–∞–π–Ω–∞ —É—É?\n\n–ë—É—Ü–∞–∞—Ö –¥“Ø–Ω: ' + formatMNT(refundTotal))) {
            return;
          }

          // Process return - add items back to inventory
          let newInventory = [...inventory];
          selectedItems.forEach(returnItem => {
            newInventory = newInventory.map(product => {
              if (product.id === returnItem.productId) {
                if (returnItem.variant && product.variants.length > 0) {
                  return {
                    ...product,
                    stock: product.stock + returnItem.returnQty,
                    variants: product.variants.map(v => 
                      v.size === returnItem.variant ? { ...v, stock: v.stock + returnItem.returnQty } : v
                    )
                  };
                }
                return { ...product, stock: product.stock + returnItem.returnQty };
              }
              return product;
            });
          });

          // Update order status
          const newOrders = orders.map(o => 
            o.id === order.id 
              ? { 
                  ...o, 
                  status: 'returned',
                  returnNote: returnNote,
                  returnedItems: selectedItems,
                  refundAmount: refundTotal
                } 
              : o
          );

          saveInventory(newInventory);
          saveOrders(newOrders);
          setShowReturnModal(null);
          setShowOrderDetail(null);
          alert('–ë—É—Ü–∞–∞–ª—Ç –∞–º–∂–∏–ª—Ç—Ç–∞–π –±“Ø—Ä—Ç–≥—ç–≥–¥–ª—ç—ç!\n\n–ë—É—Ü–∞–∞—Å–∞–Ω –¥“Ø–Ω: ' + formatMNT(refundTotal));
        };

        if (!order) return null;

        return (
          <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 overflow-y-auto">
            <div className="min-h-full flex items-start justify-center p-4 py-8">
              <div className="bg-slate-800 rounded-2xl p-5 w-full max-w-md border border-orange-500/20 shadow-2xl">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-bold text-white">üîÑ –ë—É—Ü–∞–∞–ª—Ç - #{order.id}</h3>
                  <button onClick={() => setShowReturnModal(null)} className="text-slate-400 hover:text-white text-2xl">√ó</button>
                </div>
                
                <p className="text-slate-400 text-sm mb-4">–ë—É—Ü–∞–∞—Ö –±–∞—Ä–∞–∞–≥–∞–∞ —Å–æ–Ω–≥–æ–Ω–æ —É—É:</p>
                
                <div className="space-y-3 mb-4">
                  {returnItems.map((item, index) => (
                    <div 
                      key={index} 
                      className={`rounded-xl p-3 border transition-colors ${
                        item.selected 
                          ? 'bg-orange-500/20 border-orange-500/50' 
                          : 'bg-slate-700/50 border-slate-600'
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        <input
                          type="checkbox"
                          checked={item.selected}
                          onChange={() => toggleItem(index)}
                          className="w-5 h-5 rounded accent-orange-500"
                        />
                        <div className="flex-1">
                          <p className="text-white font-semibold">{item.name}</p>
                          {item.variant && <p className="text-slate-400 text-xs">{item.variant}</p>}
                          <p className="text-amber-400 text-sm">{formatMNT(item.price)}</p>
                        </div>
                      </div>
                      
                      {item.selected && (
                        <div className="flex items-center justify-between mt-3 pt-3 border-t border-slate-600">
                          <span className="text-slate-300 text-sm">–ë—É—Ü–∞–∞—Ö —Ç–æ–æ:</span>
                          <div className="flex items-center gap-3">
                            <button 
                              onClick={() => updateQty(index, -1)}
                              className="w-8 h-8 bg-slate-600 rounded-lg text-white font-bold hover:bg-slate-500"
                            >
                              -
                            </button>
                            <span className="text-white font-bold w-8 text-center">{item.returnQty}</span>
                            <button 
                              onClick={() => updateQty(index, 1)}
                              className="w-8 h-8 bg-slate-600 rounded-lg text-white font-bold hover:bg-slate-500"
                            >
                              +
                            </button>
                            <span className="text-slate-400 text-sm">/ {item.quantity}</span>
                          </div>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
                
                <textarea
                  placeholder="–ë—É—Ü–∞–∞–ª—Ç—ã–Ω —à–∞–ª—Ç–≥–∞–∞–Ω (–∑–∞–∞–≤–∞–ª –±–∏—à)"
                  value={returnNote}
                  onChange={(e) => setReturnNote(e.target.value)}
                  className="w-full p-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 h-20 mb-4"
                />
                
                {selectedItems.length > 0 && (
                  <div className="bg-orange-500/20 rounded-xl p-3 mb-4 border border-orange-500/30">
                    <div className="flex justify-between text-white">
                      <span>–°–æ–Ω–≥–æ—Å–æ–Ω –±–∞—Ä–∞–∞:</span>
                      <span>{selectedItems.length} —à–∏—Ä—Ö—ç–≥</span>
                    </div>
                    <div className="flex justify-between text-orange-400 font-bold text-lg mt-1">
                      <span>–ë—É—Ü–∞–∞—Ö –¥“Ø–Ω:</span>
                      <span>{formatMNT(refundTotal)}</span>
                    </div>
                  </div>
                )}
                
                <div className="flex gap-3">
                  <button 
                    onClick={() => setShowReturnModal(null)} 
                    className="flex-1 p-3 bg-slate-700 text-white rounded-xl font-semibold"
                  >
                    –ë–æ–ª–∏—Ö
                  </button>
                  <button 
                    onClick={handleReturn}
                    disabled={selectedItems.length === 0}
                    className={`flex-1 p-3 rounded-xl font-semibold ${
                      selectedItems.length > 0 
                        ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white' 
                        : 'bg-slate-600 text-slate-400 cursor-not-allowed'
                    }`}
                  >
                    üîÑ –ë—É—Ü–∞–∞–ª—Ç —Ö–∏–π—Ö
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
          {/* Loading Screen */}
          {isLoading && (
            <div className="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center">
              <div className="text-center">
                <div className="text-4xl mb-4">üè™</div>
                <p className="text-white text-lg">Aspen Homestore</p>
                <p className="text-amber-400 mt-2">–ê—á–∞–∞–ª–ª–∞–∂ –±–∞–π–Ω–∞...</p>
              </div>
            </div>
          )}
          
          {/* Saving Indicator */}
          {isSaving && (
            <div className="fixed top-4 right-4 bg-amber-500 text-white px-3 py-1 rounded-full text-sm z-50 flex items-center gap-2">
              <span className="animate-spin">‚è≥</span> –•–∞–¥–≥–∞–ª–∂ –±–∞–π–Ω–∞...
            </div>
          )}
          
          {/* Sync Status */}
          {lastSync && !isSaving && (
            <div className="fixed top-4 right-4 bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs z-40 flex items-center gap-2">
              ‚úÖ {lastSync}
            </div>
          )}
          
          {/* Refresh Button */}
          <button
            onClick={loadData}
            className="fixed top-4 left-4 bg-slate-700 text-white p-2 rounded-full z-40"
          >
            üîÑ
          </button>
          
          <div className="max-w-lg mx-auto">
            {isDriverMode ? (
              <Delivery />
            ) : (
              <>
                {activeTab === 'dashboard' && <Dashboard />}
                {activeTab === 'orders' && <Orders />}
                {activeTab === 'delivery' && <Delivery />}
                {activeTab === 'inventory' && <Inventory />}
                {activeTab === 'settings' && <SettingsPage />}
              </>
            )}
          </div>

          {/* Bottom Navigation - Hidden in driver mode */}
          {!isDriverMode && (
            <div className="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-lg border-t border-slate-700">
              <div className="max-w-lg mx-auto flex justify-around py-3">
                {[
                  { id: 'dashboard', icon: 'üè†', label: '–ù“Ø“Ø—Ä' },
                  { id: 'orders', icon: 'üõí', label: '–ó–∞—Ö–∏–∞–ª–≥–∞' },
                  { id: 'delivery', icon: 'üöö', label: '–•“Ø—Ä–≥—ç–ª—Ç' },
                  { id: 'inventory', icon: 'üì¶', label: '–ê–≥—É—É–ª–∞—Ö' },
                  { id: 'settings', icon: '‚öôÔ∏è', label: '–¢–æ—Ö–∏—Ä–≥–æ–æ' }
                ].map(({ id, icon, label }) => (
                  <button
                    key={id}
                    onClick={() => handleTabChange(id)}
                    className={`flex flex-col items-center py-1 px-3 ${
                      activeTab === id ? 'text-amber-400' : 'text-slate-400'
                    }`}
                  >
                    <span className="text-xl">{icon}</span>
                    <span className="text-xs mt-1">{label}</span>
                  </button>
                ))}
              </div>
            </div>
          )}

          <PasswordModal
            isOpen={showPasswordModal}
            onClose={() => setShowPasswordModal(false)}
            onSuccess={handlePasswordSuccess}
            title={pendingTab === 'inventory' ? '–ê–≥—É—É–ª–∞—Ö' : '–¢–æ—Ö–∏—Ä–≥–æ–æ'}
          />
          <AddProductModal />
          <AddOrderModal />
          <OrderDetailModal />
          <EditProductModal />
          {showReturnModal && <ReturnModal />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
